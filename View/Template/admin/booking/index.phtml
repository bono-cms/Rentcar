<?php

use Krystal\Form\Element;
use Krystal\Widget\GridView\GridViewWidget;
use Cms\View\Icon;

defined('KRYSTAL') or die;

?>

<div class="btn-toolbar">
    <div class="btn-group">
        <a href="<?= $this->url('Rentcar:Admin:Booking@addAction'); ?>" class="btn btn-primary btn-sm"><?php $this->show('Add new booking'); ?></a>
    </div>
</div>

<div class="card">
    <h4 class="mb-4"><i class="fas fa-address-card"></i> <?php $this->show('Bookings'); ?> <small class="text-muted">(<?= count($bookings); ?>)</small></h4>

    <div class="table-responsive">
        <?= $this->widget(new GridViewWidget($bookings, [
            'tableClass' => 'table table-bordered table-stripped',
            'columns' => [
                [
                    'column' => 'id',
                    'label' => '#',
                    'attributes' => [
                        'class' => 'text-muted text-center'
                    ]
                ],

                [
                    'column' => 'car',
                    'value' => function($row){
                        // Create HTML Image element
                        $image = Element::image($row['image'], ['class' => 'w-25']);
                        
                        $content = Element::link($image, $this->url('Rentcar:Admin:Car@editAction', $row['car_id']));
                        $content .= '<br>';
                        $content .= $row['car'];

                        return $content;
                    }
                ],

                [
                    'column' => 'pickup'
                ],
                
                [
                    'column' => 'return'
                ],

                [
                    'column' => 'name',
                    'label' => 'Client'
                ],

                [
                    'column' => 'datetime',
                    'label' => 'Date and time'
                ],

                [
                    'column' => 'amount',
                    'value' => function($row){
                        return number_format($row['amount']);
                    }
                ]
            ],

            'actions' => [
                'view' => function($row){
                    return Icon::details(
                        $this->url('Rentcar:Admin:Booking@detailsAction', $row['id']),
                        $this->translate('View booking details')
                    );
                },

                'edit' => function($row){
                    return Icon::edit(
                        $this->url('Rentcar:Admin:Booking@editAction', $row['id']),
                        $this->translate('Edit this booking entry')
                    );
                },

                'remove' => function($row){
                    return Icon::remove(
                        $this->url('Rentcar:Admin:Booking@deleteAction', $row['id']),
                        $this->translate('Remove this booking entry')
                    );
                }
            ]
        ])); ?>
    </div>
</div>

